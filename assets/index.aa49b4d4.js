import{t as j,o as ee,a as te,k as A,w as se,s as oe,f as ne,d as O,b as ie,n as ae,l as le,m as re,A as de,G as v,C as z,T as f,u as ce,r as p,c as fe,e as he,g as R,h as B,i as a,j as W,F as Y,p as ue,q as pe,v as me,x as ge,y as we,z as D,B as _e}from"./vendor.7d0921de.js";const ve=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&s(d)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}};ve();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ye{constructor(t){this.numClasses=t}addExample(t,n){const s=j(()=>ee(te([n]).toInt(),this.numClasses));if(this.xs==null)this.xs=A(t),this.ys=A(s);else{const o=this.xs;this.xs=A(o.concat(t,0));const i=this.ys;this.ys=A(i.concat(s,0)),o.dispose(),i.dispose(),s.dispose()}}}const G=4,y=new ye(G);let N,I,x,F=!1;async function xe(){const e=await le("https://storage.googleapis.com/tfjs-models/tfjs/mobilenet_v1_0.25_224/model.json"),t=e.getLayer("conv_pw_13_relu");return re({inputs:e.inputs,outputs:t.output})}async function H(){const e=await N.capture(),t=j(()=>e.expandDims(0).toFloat().div(127).sub(1));return e.dispose(),t}var b={async init(e,t,n){try{N=await se(e)}catch(o){console.log("[Error]",o),t.style.display="block"}x=await xe(),n&&n();const s=await N.capture();x.predict(s.expandDims(0)),s.dispose()},async train(e){if(F=!1,y.xs==null)throw new Error("Add some examples before training!");I=oe({layers:[ne({inputShape:x.outputs[0].shape.slice(1)}),O({units:100,activation:"relu",kernelInitializer:"varianceScaling",useBias:!0}),O({units:G,kernelInitializer:"varianceScaling",useBias:!1,activation:"softmax"})]});const t=ie.adam(1e-4);I.compile({optimizer:t,loss:"categoricalCrossentropy"});const n=Math.floor(y.xs.shape[0]*.4);if(!(n>0))throw new Error("Batch size is 0 or NaN. Please choose a non-zero fraction.");I.fit(y.xs,y.ys,{batchSize:n,epochs:20,callbacks:{onBatchEnd:async(s,o)=>{e&&e(o)}}})},async predict(e){for(F=!0;F;){const t=await H(),n=x.predict(t),i=(await I.predict(n).as1D().argMax().data())[0];e&&e(i),t.dispose(),await ae()}},async handler(e,t){let n=await H();y.addExample(x.predict(n),e);const[s,o]=[224,224],i=t.getContext("2d"),d=new ImageData(s,o),m=n.dataSync();for(let h=0;h<o*s;++h){const g=h*4;d.data[g+0]=(m[h*3+0]+1)*127,d.data[g+1]=(m[h*3+1]+1)*127,d.data[g+2]=(m[h*3+2]+1)*127,d.data[g+3]=255}i.putImageData(d,0,0),n.dispose()},stopPredict(){F=!1}};let l,w,C,E,S,T=0,u,P;const c=(e,t)=>{e.position.x=t.width/2,e.position.y=t.height/2,e.pivot.x=e.width/2,e.pivot.y=e.height/2},q=(e,t)=>{e.rotation=Math.PI*t/180},k=(e,t,n)=>{let s=new v;s.beginFill(16777215),s.drawRoundedRect(0,0,200,50,5),s.endFill(),s.interactive=!0,s.buttonMode=!0,s.on("click",i=>{n&&n(i)}),c(s,e);let o=new f(t,{fontSize:25,fill:15343203,align:"center"});return s.addChild(o),c(o,s),e.addChild(s),s},$=e=>{let t=new v;t.beginFill(16777215),t.drawRoundedRect(0,0,200,200,10),t.endFill();let n=new z;n.addChild(t);let s=new f(e,{fontSize:30,fill:16726141});n.addChild(s),c(s,n),l.stage.addChild(n),c(n,l.screen),setTimeout(()=>{l.stage.removeChild(n)},2e3)},V=()=>{let e=new v;e.beginFill(16726141),e.drawRect(0,0,640,700),e.endFill(),w=new z,w.addChild(e);let t=new f("E",{fontSize:80,fill:16777215,stroke:"#4a1850",strokeThickness:3});e.addChild(t),c(t,e),t.y-=100;let n=0;l.ticker.add(i=>{n+=i,q(t,n)});let s=new f("Welcome to ArVision !",{fontSize:30,fontWeight:600,fill:16777215,align:"center",stroke:"#4a1850",strokeThickness:5});e.addChild(s),c(s,e),console.log(s),S=k(e,"Start",i=>{Ce(),l.stage.removeChild(w)}),S.y+=s.height+50;let o=k(e,"Introduction",i=>{be(),l.stage.removeChild(w)});o.y=S.y+S.height+20,l.stage.addChild(w),c(w,l.screen)},be=()=>{C=new z;let e=new v;e.beginFill(16777215),e.drawRoundedRect(0,0,500,300,10),e.endFill(),C.addChild(e);let t=new f("Intro",{fontSize:30,fill:16726141,align:"left"});t.x=20,t.y=20,e.addChild(t);let n=new f(`The game is called AR Vision.
       1. You can add examples represented for up & down & left & right at right by camera.
       2. Click the start button to start the game: You should pose the corresponding examples added , for every character 'E'.`,{fontSize:20,fill:16726141,wordWrap:!0,wordWrapWidth:500,align:"left"});e.addChild(n),c(n,e);let s=k(e,"Close",()=>{V(),l.stage.removeChild(C)});s.y+=e.height,l.stage.addChild(C),c(C,l.screen)},Ce=()=>{let e=new v;e.beginFill(16726141),e.drawRect(0,0,640,700),e.endFill(),E=new z,E.addChild(e);let t=new f("Posing  for  'E'  in  3s !",{fill:16777215,stroke:"#4a1850",strokeThickness:5});t.x=e.width/2-60,t.y=20,e.addChild(t),u=new f("E",{fontSize:80,fill:16777215,align:"center"}),e.addChild(u),c(u,e);let n=k(e,"Return",()=>{l.stage.removeChild(E),V()});n.x=n.width/2+10,n.y=n.height/2+10;let s=new f("0s",{fontSize:30,fill:16777215});e.addChild(s),c(s,e),s.y=n.height+n.y+10;let o=new f("Your eyesight is xx",{fontSize:30,fill:16777215});e.addChild(o),o.x=10,o.y=e.height-o.height,P(s,o);let i=k(e,"Next",()=>{T=Math.floor(Math.random()*4),console.log(T),q(u,90*T),P(s,o)});i.y+=u.height+50,l.stage.addChild(E)};var L={init(e){l=new de({width:640,height:750,backgroundColor:15343203,backgroundAlpha:.9}),e.appendChild(l.view),V()},addStartHandler(e){S.on("click",t=>{e&&e(t)})},addPredictHandler(e){P=(t,n)=>{let s=3,o=setInterval(()=>{if(console.log("[ArVision] Checking..."),t.text=s+"s",s<=0&&(clearInterval(o),$("Overtime ! \uFF01!"),u.style.fontSize=80),e(T)){clearInterval(o),$("Nice Job ! \uFF01!");let i=4+(80-u.style.fontSize)/70;console.log(i,u.style.fontSize),n.text="Your eyesight is "+i,u.style.fontSize-=7}s-=.5},500)}}};var Se=(e,t)=>{const n=e.__vccOpts||e;for(const[s,o]of t)n[s]=o;return n};const _=e=>(me("data-v-62d2c050"),e=e(),ge(),e),ke={ref:"no-webcam",class:"no-webcam"},Ae=D(" No webcam found. "),ze=_(()=>a("br",null,null,-1)),Ie=D("To use this demo, use a device with a webcam. "),Fe=[Ae,ze,Ie],Ee=_(()=>a("section",{class:"loading"},[D(" Loading MobileNet... "),a("span",{class:"loading__tip"},"AR Vision \u2014\u2014 A Simple Game by AR."),a("span",{class:"loading__anim"})],-1)),Te={class:"main"},Me={class:"webcam-outer"},Re={class:"webcam-inner"},Be={class:"webcam-wrapper"},De={class:"webcam-sider"},Ne={class:"intro"},Pe=_(()=>a("h3",null,"Camera: Capture your photos!",-1)),Ve=_(()=>a("li",null,"1. Add examples for 4 directions.",-1)),Le=_(()=>a("li",null,"3. Start the game.",-1)),je={class:"thumbs-outer"},Oe=_(()=>a("h3",{class:"title"},"Pose Examples for game",-1)),We={class:"thumbs-wrapper"},Ye={class:"tag"},Ge=["onClick"],He={setup(e){ce(r=>({"63be6774":t.value,"4d8e2341":n.value}));const t=p("block"),n=p("none"),s=p(0),o=p(-1),i=p(null),d=p(null),m=p(null),h=p([]),g=fe(["right","down","left","up"]),J=r=>{h.value.push(r)};he(()=>{b.init(i.value,d.value,()=>{t.value="none",n.value="flex"}),L.init(m.value),L.addStartHandler(()=>{console.log("[ArVision] Start Gaming...")}),L.addPredictHandler(r=>(console.log("[ArVision] now: %d, target: %d",o.value,r),r===o.value))});const K=()=>{console.log("[ArVision] Training..."),b.train(r=>{s.value=r.loss.toFixed(5)})},U=()=>{console.log("[ArVision] Predict..."),b.predict(r=>{o.value=r})},X=()=>{console.log("[ArVision] Stop Predict..."),b.stopPredict()},Q=r=>{console.log("[ArVision] Add Example %s...",r),b.handler(r,h.value[r])};return(r,$e)=>(R(),B(Y,null,[a("div",ke,Fe,512),Ee,a("div",Te,[a("div",{class:"pixiDom",ref_key:"pixiDom",ref:m},null,512),a("div",Me,[a("div",Re,[a("div",Be,[a("video",{autoplay:"",playsinline:"",muted:"",class:"webcam",ref_key:"webcam",ref:i,width:"224",height:"224"},null,512)]),a("div",De,[a("div",Ne,[Pe,a("ol",null,[Ve,a("li",null,"2. Training for loss:"+W(s.value)+" stable and predict",1),Le])]),a("button",{onClick:K,class:"train-btn"},"Train"),a("button",{onClick:U,class:"predict-btn"},"Predict"),a("button",{onClick:X,class:"stop-btn"},"Stop")])]),a("div",je,[Oe,a("div",We,[(R(!0),B(Y,null,ue(pe(g),(Z,M)=>(R(),B("div",{class:"thumb",key:M},[a("div",{class:we(["item",o.value==M?"active":""])},[a("canvas",{class:"thumb-canvas",width:"224",height:"224",ref_for:!0,ref:J}),a("div",Ye,"For "+W(Z),1)],2),a("button",{class:"thumb-btn",onClick:Je=>Q(M)},"Add example",8,Ge)]))),128))])])])])],64))}};var qe=Se(He,[["__scopeId","data-v-62d2c050"]]);_e(qe).mount("#app");
